<!DOCTYPE html>
<html>
  <head>
    <title>User-editable Shapes</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 95%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 95%;
        margin: 0;
        padding: 0;
      }
    </style>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  </head>
  <body>

    <form action="/" id="mapForm">
      <input type="submit" value="Search">
    </form>

    <div id="result"> </div>

    <div id="map"></div>
    <script>
      // This example adds a user-editable rectangle to the map.

			var myPolygon

      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 37.98993962366689, lng: -87.4405288696289},
          zoom:12 
        });

				var triangleCoords = [new google.maps.LatLng(37.9899, -87.4405),
				  new google.maps.LatLng(37.9699, -87.4805),
					new google.maps.LatLng(37.9599, -87.4105)
				];

				myPolygon = new google.maps.Polygon({
					paths: triangleCoords,
					draggable: true,
					editable: true,
					strokeColor: '#ff0000',
					strokeOpacity: 0.8,
					strokeWeight: 2,
					fillColor: '#ff0000',
					fillOpacity: 0.35
				});

				myPolygon.setMap(map);

				google.maps.event.addListener(myPolygon.getPath(), "insert_at", getPolygonCoords);
				google.maps.event.addListener(myPolygon.setPath(), "set_at", getPolygonCoords);
      }

      $("#mapForm").submit(function(event) {

        event.preventDefault();

        json_data = getPolygonCoords();
        var posting = $.post("http://localhost:8080/geofence/", json_data, "json");

        posting.done(function(data) {
          var content = $(data).find("#content");
          $("#result").empty().append(content);
        });

      });

			function getPolygonCoords() {

          var vertices = myPolygon.getPath();
          var points_array = []; // list of polyline points

          for (var i=0; i<vertices.getLength(); i++) {
            var xy = vertices.getAt(i);
            var item = {"lat": xy.lat(), "lng": xy.lng()};
            points_array.push(item);
          }
          var alias = document.getElementById('alias').value;
          var polygon ={"data": {"alias": alias, "points": points_array}};

          console.log(polygon);

          return polygon;
			}

    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB65O3xpqFz8fqZ46nFLWFJ9Nq-CMOfky4 &callback=initMap">
    </script>
  </body>
    <input type="text" id="alias" name="alias"/>
		<textarea id="info"> </textarea>
</html>
